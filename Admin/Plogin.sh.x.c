#if 0
	shc Version 3.8.9b, Generic Script Compiler
	Copyright (c) 1994-2015 Francisco Rosales <frosal@fi.upm.es>

	shc -f Plogin.sh 
#endif

static  char data [] = 
#define      chk1_z	22
#define      chk1	((&data[1]))
	"\122\332\310\020\100\235\370\225\220\025\043\252\131\005\131\335"
	"\141\113\365\241\203\313\152\017\214\070\164\123"
#define      lsto_z	1
#define      lsto	((&data[28]))
	"\000"
#define      pswd_z	256
#define      pswd	((&data[42]))
	"\222\371\160\134\115\012\371\202\273\312\346\056\166\002\272\245"
	"\301\155\025\214\264\242\171\330\124\013\364\114\105\053\221\340"
	"\057\324\275\244\043\017\330\350\132\123\101\105\126\373\352\030"
	"\151\377\245\036\242\037\366\367\052\353\104\157\026\325\120\105"
	"\251\016\352\314\036\303\265\170\027\366\275\156\362\247\206\133"
	"\247\054\171\112\113\157\102\165\133\206\345\161\133\065\267\005"
	"\104\242\322\142\145\210\332\175\176\230\353\161\100\162\314\347"
	"\236\106\062\351\266\164\136\021\373\104\203\127\171\073\134\275"
	"\335\056\040\103\266\372\301\065\223\254\247\323\036\163\272\274"
	"\272\355\246\161\141\005\203\134\111\006\263\302\102\020\200\040"
	"\077\240\144\366\233\045\053\056\321\322\001\357\106\274\254\001"
	"\252\122\163\013\127\366\150\240\375\034\143\077\054\344\137\154"
	"\205\303\142\040\350\216\117\272\141\121\252\250\015\126\251\267"
	"\251\035\303\001\023\054\242\020\110\005\120\165\352\260\341\157"
	"\164\104\220\135\322\337\027\063\060\301\334\076\030\205\366\301"
	"\243\271\302\266\345\145\307\056\152\030\244\125\310\206\304\074"
	"\312\124\231\234\064\261\320\144\162\254\242\212\062\211\271\251"
	"\042\005\177\165\025\013\256\212\137\025"
#define      tst1_z	22
#define      tst1	((&data[315]))
	"\236\377\263\227\205\042\257\260\161\205\350\363\037\012\205\053"
	"\056\210\102\140\136\327\103\330\001\312"
#define      msg2_z	19
#define      msg2	((&data[337]))
	"\376\311\302\037\246\203\144\053\311\164\201\223\144\024\247\034"
	"\006\037\377\172\011\147\066"
#define      text_z	1286
#define      text	((&data[458]))
	"\112\327\036\363\372\044\162\160\071\176\036\303\335\064\055\250"
	"\126\313\247\012\142\030\032\107\223\043\257\311\366\375\056\101"
	"\324\115\064\317\161\247\077\252\045\136\156\002\223\233\253\351"
	"\147\123\363\311\153\015\021\376\061\300\310\050\275\367\151\222"
	"\104\236\142\265\105\242\140\153\001\317\155\224\152\031\176\322"
	"\154\161\234\330\177\255\327\260\156\237\330\054\227\102\277\333"
	"\340\042\276\247\115\270\230\376\145\053\115\174\012\025\146\223"
	"\100\261\353\362\252\203\301\357\265\273\253\012\231\034\270\125"
	"\015\103\245\131\342\120\370\332\034\143\374\100\265\042\134\320"
	"\223\266\052\276\013\013\142\242\321\322\166\345\001\214\177\215"
	"\256\054\227\124\060\122\364\376\006\313\140\106\114\160\161\352"
	"\157\344\353\172\263\324\007\237\237\133\205\355\333\325\060\257"
	"\031\115\230\331\365\203\171\367\330\007\212\170\367\070\360\172"
	"\316\237\141\231\262\221\115\337\344\173\300\120\175\332\071\251"
	"\004\077\207\204\255\014\124\051\334\157\153\167\106\005\352\357"
	"\175\224\044\032\252\052\117\337\171\214\361\116\133\071\123\052"
	"\337\007\317\206\267\322\245\200\311\327\135\125\034\146\360\370"
	"\005\045\167\373\322\356\065\061\352\165\205\043\351\210\226\017"
	"\326\200\235\212\034\164\261\031\072\104\104\251\075\072\011\266"
	"\214\270\013\171\372\103\035\030\102\241\270\131\250\322\172\121"
	"\203\247\212\150\025\323\351\114\320\231\306\056\151\164\321\247"
	"\237\161\352\372\323\373\132\152\164\072\352\205\204\031\233\304"
	"\022\104\200\300\323\010\057\313\076\122\343\163\143\315\132\352"
	"\034\070\357\314\132\210\317\143\235\012\202\173\214\241\075\352"
	"\132\337\365\013\005\211\053\375\061\252\071\364\346\210\036\353"
	"\322\057\344\243\123\343\253\331\117\001\276\045\145\213\056\325"
	"\036\163\033\113\155\174\301\315\352\313\151\276\022\235\164\113"
	"\214\053\303\265\354\233\262\221\374\062\061\037\105\002\104\172"
	"\202\214\254\366\147\014\322\214\313\321\117\242\241\010\002\011"
	"\057\325\362\270\151\262\234\210\033\260\103\017\142\256\231\041"
	"\363\040\220\234\173\276\123\067\232\174\320\014\037\145\261\355"
	"\121\247\372\255\274\104\325\033\325\135\126\042\200\012\050\356"
	"\001\021\175\357\276\256\253\306\005\340\372\163\047\250\123\335"
	"\133\346\100\052\004\251\105\322\027\257\242\176\315\257\214\136"
	"\102\312\256\240\115\131\132\117\211\323\064\007\075\241\057\276"
	"\210\122\150\251\170\165\003\137\011\170\174\260\223\343\066\301"
	"\376\240\324\321\274\274\151\151\067\247\327\264\256\333\334\374"
	"\220\330\134\134\036\214\201\061\071\255\374\233\077\170\264\217"
	"\137\306\273\317\377\245\314\166\366\036\127\313\320\240\165\213"
	"\160\360\152\140\022\234\114\250\253\234\046\245\305\147\342\326"
	"\165\232\256\351\236\151\147\365\120\022\347\214\253\341\100\130"
	"\255\127\356\244\174\303\042\160\241\305\061\251\014\051\270\106"
	"\105\035\023\273\341\257\257\016\215\216\273\205\327\212\371\241"
	"\317\052\063\370\224\111\126\226\102\315\223\150\006\255\373\026"
	"\071\240\163\010\212\275\335\214\235\034\302\242\050\301\103\266"
	"\275\323\155\327\366\233\036\143\014\150\012\017\132\201\342\225"
	"\067\253\211\266\365\310\014\362\042\257\265\156\264\317\065\040"
	"\235\356\114\355\315\271\251\333\174\111\240\132\230\334\375\056"
	"\305\113\050\152\133\357\104\241\241\167\116\071\176\250\336\070"
	"\011\112\354\254\120\213\070\010\263\064\201\235\324\052\145\224"
	"\125\337\021\131\143\260\210\006\330\076\260\130\161\117\311\327"
	"\064\176\331\334\226\117\323\041\160\143\246\222\152\131\110\101"
	"\372\125\243\333\165\064\335\377\323\075\232\164\321\334\317\330"
	"\305\306\134\215\033\265\367\304\335\077\106\301\130\241\267\072"
	"\227\100\301\120\013\042\221\104\306\120\121\000\157\301\026\014"
	"\140\342\000\314\136\370\143\020\320\374\321\312\363\277\070\375"
	"\247\124\356\306\012\106\263\040\015\221\132\162\040\020\025\213"
	"\260\130\377\104\021\232\201\052\243\011\372\337\163\104\001\142"
	"\253\047\210\263\377\156\070\246\012\112\305\130\221\204\021\362"
	"\236\050\027\316\362\242\237\354\115\035\236\156\233\136\212\076"
	"\243\155\273\113\357\120\164\264\206\106\204\201\030\074\060\277"
	"\006\000\247\063\024\156\132\142\333\312\117\304\207\233\077\254"
	"\233\227\037\117\161\115\362\310\107\276\324\175\107\230\255\321"
	"\061\273\022\042\022\272\276\160\363\321\041\330\343\153\034\067"
	"\260\260\251\377\033\264\214\167\030\052\317\322\375\240\321\005"
	"\021\320\326\325\235\352\142\142\027\210\372\233\322\222\047\010"
	"\160\321\066\064\024\361\155\264\011\254\004\013\044\103\373\352"
	"\104\014\105\024\116\017\066\034\276\322\314\100\363\345\130\034"
	"\345\163\157\143\011\212\133\265\344\346\105\335\073\073\203\110"
	"\175\156\126\177\071\074\251\117\142\174\011\300\360\014\276\046"
	"\150\320\013\040\107\070\150\176\246\336\050\034\105\057\361\330"
	"\110\371\030\160\335\317\311\272\346\256\312\001\230\133\216\164"
	"\175\003\347\313\126\323\067\252\340\213\100\061\243\124\331\242"
	"\114\130\220\326\331\202\171\250\113\120\061\136\044\007\073\224"
	"\325\256\221\162\063\235\067\257\371\270\263\234\342\244\320\157"
	"\222\215\302\032\033\317\367\221\345\063\265\120\073\114\300\016"
	"\120\105\036\202\317\233\343\104\115\247\037\006\157\223\136\376"
	"\370\072\364\375\327\324\265\003\233\342\113\303\037\116\147\172"
	"\261\105\072\237\114\154\144\274\057\356\020\160\236\377\022\215"
	"\111\136\155\164\123\346\070\031\002\224\116\256\001\347\143\201"
	"\344\302\317\277\305\235\032\277\054\243\360\122\075\045\227\344"
	"\124\245\132\134\375\240\345\223\354\103\167\107\056\331\034\350"
	"\347\012\152\077\275\067\104\345\106\331\155\123\155\030\364\035"
	"\341\160\322\311\236\034\234\175\374\156\125\265\117\023\104\336"
	"\056\336\031\267\200\151\312\376\002\312\021\147\003\211\202\030"
	"\373\104\037\144\332\022\367\224\017\355\025\152\131\042\366\000"
	"\323\330\247\313\166\033\331\241\221\045\304\361\220\305\300\376"
	"\132\053\030\330\375\205\112\231\135\311\107\064\172\266\324\123"
	"\342\153\225\242\107\166\304\330\234\210\312\054\116\213\053\250"
	"\267\104\201\265\311\313\117\046\225\226\133\020\115\057\143\057"
	"\233\371\322\342\157\226\272\013\037\205\070\156\020\144\027\307"
	"\250\230\174\161\144\313\230\372\142\363\012\257\043\156\337\276"
	"\147\262\241\327\110\133\342\150\341\033\326\361\200\355\271\050"
	"\206\066\232\352\002\063\344\145\047\356\024\112\134\364\011\304"
	"\246\252\233\357\006\176\127"
#define      tst2_z	19
#define      tst2	((&data[1874]))
	"\331\032\033\263\326\254\250\351\236\020\031\240\227\224\165\066"
	"\036\075\155\006\261\240"
#define      rlax_z	1
#define      rlax	((&data[1893]))
	"\214"
#define      opts_z	1
#define      opts	((&data[1894]))
	"\130"
#define      chk2_z	19
#define      chk2	((&data[1895]))
	"\307\003\043\225\050\077\015\063\055\250\273\071\011\253\034\016"
	"\210\337\352\061\070"
#define      xecc_z	15
#define      xecc	((&data[1917]))
	"\273\102\161\325\124\222\364\372\050\137\011\171\205\211\332\067"
	"\073\215"
#define      msg1_z	42
#define      msg1	((&data[1943]))
	"\033\321\077\232\051\047\064\126\000\012\153\056\215\060\060\234"
	"\234\064\011\100\270\206\276\370\054\246\020\350\074\344\332\312"
	"\321\002\231\257\103\343\253\030\163\221\270\073\254\315\050\203"
	"\350\216\374\116\162"
#define      date_z	1
#define      date	((&data[1987]))
	"\336"
#define      shll_z	10
#define      shll	((&data[1989]))
	"\052\314\166\100\075\372\047\276\042\363\344\201"
#define      inlo_z	3
#define      inlo	((&data[2000]))
	"\376\313\043"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	0	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
